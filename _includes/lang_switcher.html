<span class="lang-switch">
  {% assign current_lang = page.lang | default: site.lang | default: 'es' %}

  {% if current_lang == 'es' %}
    {% assign target_lang = 'en' %}
  {% else %}
    {% assign target_lang = 'es' %}
  {% endif %}

  {% assign pairs = site.data.translation_map %}
  {% assign target_url = '/' | append: target_lang | append: '/' %}
  {% assign cur_url = page.url | default: page.permalink %}

  {% if pairs %}
    {% for p in pairs %}
      {% assign from_url = p[current_lang] %}
      {% assign to_url   = p[target_lang] %}
      {% if from_url and to_url %}
        {% if cur_url == from_url or page.permalink == from_url %}
          {% assign target_url = to_url %}
          {% break %}
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endif %}

  {% if current_lang == 'es' %}
    <strong>Español</strong> | <a href="{{ target_url | relative_url }}">English</a>
  {% else %}
    <a href="{{ target_url | relative_url }}">Español</a> | <strong>English</strong>
  {% endif %}
</span>
